{
  "rules": {
    "social_accounts": {
      "$accountId": {
        // Allow read if user is authenticated and owns the account
        ".read": "auth != null && data.child('userId').val() === auth.uid",
        // Allow write if user is authenticated and is setting their own userId
        ".write": "auth != null && (!data.exists() || data.child('userId').val() === auth.uid)",
        // Validate all required fields are present
        ".validate": "newData.hasChildren(['userId', 'platform', 'username', 'accessToken', 'refreshToken', 'expiresAt', 'createdAt'])",
        "userId": {
          ".validate": "newData.isString() && newData.val() === auth.uid"
        },
        "platform": {
          ".validate": "newData.isString() && newData.val().matches(/^(tiktok|youtube|instagram|facebook|linkedin|drive|dropbox|twitter|snapchat)$/)"
        },
        "username": {
          ".validate": "newData.isString() && newData.val().length > 0"
        },
        "accessToken": {
          ".validate": "newData.isString() && newData.val().length > 0"
        },
        "refreshToken": {
          ".validate": "newData.isString()"
        },
        "expiresAt": {
          ".validate": "newData.isNumber() && newData.val() > now"
        },
        "createdAt": {
          ".validate": "newData.isNumber() && newData.val() <= now"
        },
        // Optional fields
        "displayName": {
          ".validate": "!newData.exists() || newData.isString()"
        },
        "email": {
          ".validate": "!newData.exists() || newData.isString()"
        },
        "profilePicture": {
          ".validate": "!newData.exists() || newData.isString()"
        },
        // Disallow other fields
        "$other": {
          ".validate": false
        }
      }
    }
  }
}